self.addEventListener("push",async n=>{const e=n.data.json();if(n.waitUntil(self.registration.showNotification(e.title,{body:e.body,icon:"/icon512_rounded.png",vibrate:[200,100,200],data:{conversationId:e.conversationId},requireInteraction:!0,badge:"/icon512_maskable.png"})),self.matchMedia("(display-mode: standalone)").matches||!0===self.navigator.standalone)try{const n=new Audio("/ping.mp3");n.volume=.7,n.play().catch(n=>{console.error("Audio playback failed:",n)})}catch(n){console.error("Audio setup failed:",n)}self.clients.matchAll({type:"window",includeUncontrolled:!0}).then(n=>{for(const o of n)o.postMessage({type:"NEW_MESSAGE",conversationId:e.conversationId,message:e})})}),self.addEventListener("notificationclick",n=>{var e;n.notification.close();const o=null===(e=n.notification.data)||void 0===e?void 0:e.conversationId;n.waitUntil(clients.matchAll({type:"window"}).then(n=>{for(const e of n)if(e.url.includes("/messages")&&"focus"in e)return o&&e.postMessage({type:"OPEN_CONVERSATION",conversationId:o}),e.focus();if(clients.openWindow){const n=o?`/messages?conversation=${o}`:"/messages";return clients.openWindow(n)}}))});